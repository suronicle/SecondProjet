<!DOCTYPE html>


<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>

  <!-- Basic Page Needs
  ================================================== -->
  <meta charset="utf-8">
  <title> 숨쉬는서재 | 포인트게임 </title>

  <!-- Mobile Specific Metas
  ================================================== -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Construction Html5 Template">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="author" content="Themefisher">
  <meta name="generator" content="Themefisher Constra HTML Template v1.0">
  
  <!-- theme meta -->
  <meta name="theme-name" content="aviato" />
  
  <!-- Favicon -->
  <link rel="shortcut icon" type="./e-comm/image/x-icon" href="./e-comm/images/titlelogo.png" />
  
  <!-- Themefisher Icon font -->
  <link rel="stylesheet" href="./e-comm/plugins/themefisher-font/style.css">
  <!-- bootstrap.min css -->
  <link rel="stylesheet" href="./e-comm/plugins/bootstrap/css/bootstrap.min.css">
  
  <!-- Animate css -->
  <link rel="stylesheet" href="./e-comm/plugins/animate/animate.css">
  <!-- Slick Carousel -->
  <link rel="stylesheet" href="./e-comm/plugins/slick/slick.css">
  <link rel="stylesheet" href="./e-comm/plugins/slick/slick-theme.css">
  
  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="./e-comm/css/style.css">
  
    <style>
        @font-face {
            font-family: 'GmarketSansMedium';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        #wrap {
            background-color: #ffffff;
            position: relative;
            overflow: hidden;
        }

        #wrap #gameContainer {
            width: 508px;
            height: 571px;
            text-align: center;
            position: relative;
            margin: 0px auto;
        }

        #wrap #gameContainer .board_start img {
            width: 100%;
        }

        #wrap #gameContainer .board_bg {
            width: 508px;
            height: 508px;
            top: 40px;
            left: 0px;
            z-index: 2;
        }

        #wrap #gameContainer .board_bg img {
            width: 100%;
        }

        #wrap #gameContainer .board_on {
            width: 508px;
            height: 508px;
            top: 40px;
            left: 0px;
            z-index: 3;
            background-image: url('//img.babathe.com/upload/specialDisplay/htmlImage/2019/test/roulette_circle_bg.png');
            background-size: 508px;
        }

        #wrap #gameContainer .board_on img {
            position: absolute;
            width: 100px;
            top: 115px;
            height: 100px;
        }

        #wrap #gameContainer .board_on img:nth-child(1) {
            left: 55px;
            transform: rotate(-60deg);
            top: 120px;
        }

        #wrap #gameContainer .board_on img:nth-child(2) {
            left: 62px;
            transform: rotate(-113deg);
            top: 286px;
        }

        #wrap #gameContainer .board_on img:nth-child(3) {
            left: 208px;
            top: 372px;
            transform: rotate(-180deg);
        }

        #wrap #gameContainer .board_on img:nth-child(4) {
            left: 351px;
            top: 286px;
            transform: rotate(-245deg);
        }

        #wrap #gameContainer .board_on img:nth-child(5) {
            left: 351px;
            top: 125px;
            transform: rotate(-292deg);
        }

        #wrap #gameContainer .board_on img:nth-child(6) {
            left: 205px;
            top: 42px;
            transform: rotate(5deg);
        }

        #wrap #gameContainer .obj.board_arrow {
            width: 90px;
            height: 105px;
            top: 0px;
            left: 195px;
            z-index: 5;
        }

        .popup {
            display: none;
            position: fixed;
            left: 50%;
            z-index: 99999;
            text-align: center;
            background: #fff;
            font-size: 20px;
            color: #000;
        }

        #fade {
            display: none;
            background: #000;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: .60;
            z-index: 9999;
        }

        #popup_gift {
            width: 475px;
            height: 300px;
            top: 120px;
        }

        #popup_gift .lottery_present {
            text-align: center;
        }

        #popup_gift .lottery_present img {
            display: block;
            margin: 50px auto 30px;
        }

        #popup_fail {
            width: 475px;
            height: 505px;
            top: 120px;
        }

        .popup .close {
            display: inline-block;
            width: 150px;
            height: 50px;
            line-height: 50px;
            color: #fff;
            background: #333;
            margin: 30px 0 0;
        }
    </style>
    
    <style>

    .static { position: fixed; bottom: 200px; right: 200px; }
    .butellipse {width: 50px; height: 50px; border-radius: 50px; border : 1px solid black;}

	</style>
	
	<style>
            td{
                width: 100px;
                height: 100px;
                color: black;
            }
            
            th {
                width: 100px;
                height: 100px;
                color: black;
                text-align:center;
                font-size: 30px;
            }
            
            tr > td:first-child > p,
            tr > th:first-child > p {
                color: red;
            }
            tr > td:last-child > p,
            tr > th:last-child > p {
                color: blue;
            }
            td > p:hover {
                cursor: pointer;
            }
            
            table, td, th {
			  border : 1px solid black;
			  border-collapse : collapse;
			  border-color:#A1DD70; 
			};
			
			.application-box img {
			  width:100%;
			}
			
			.application-box .application-desc-container {
			  position: absolute;
			  Top : 30px;
			  left: auto;
			  margin-left: 25px;
			  /* 여백 비율 조정 */
			}
        </style>
	


</head>

<body id="body">

<th:block th:insert="~{ecom_fragments::header}"></th:block>
<th:block th:insert="~{ecom_fragments::menu}"></th:block>


<section class="page-header">
	<div class="container">
		<div class="row">
			<div class="col-md-12">
				<div class="content">
					<h1 class="page-name">포인트적립이벤트</h1>
					<ol class="breadcrumb">
						<li><a href="index.html">Home</a></li>
						<li class="active">포인트적립이벤트</li>
					</ol>
				</div>
			</div>
		</div>
	</div>
</section>
 
<section class="pricing-table">
    <div class="container">
    	 
		<img th:src="@{./e-comm/images/pointimg.jpg}" style="width: 100%;">
		<div style="background-color: #A1DD70;">
	    	 
			
			
	        <div style="font-size: 2em; text-align:left;" >
	        <img id="point" th:src="@{./e-comm/images/pointtitle.png}" style="width: 45%; position:relative; display: inline-block;">
	        <h1 th:text="${#temporals.format(localDateTime, 'yyyy 년 MM 월')}" style="font-size: 50px; display: inline-block; margin-left: -25%; position: absolute; margin-top: 6%;"></h1>
	        <h4 style="display: inline-block; margin-left: -25%; position: absolute; margin-top: 2%; color: white;" 
	        th:text="'이번달 총 ' + ${pointAll} + 'P 적립(출석:' + ${pointcks} + '/룰렛:' + ${pointAll - pointcks} + ')'"></h4>
			<button th:if="${mid != 'none' && pointckY != 1}" type="button" style="background-color:transparent; border:none; width: 300px; float: right; margin-top: 10%;" onclick="pointF(1,10);">
					<img th:src="@{./e-comm/images/pointbtn.png}" style="width: 100%;">
			</button>
			<button th:if="${mid != 'none' && pointckY == 1}" type="button" style="background-color:transparent; border:none; width: 300px; float: right; margin-top: 10%;">
					<img th:src="@{./e-comm/images/pointbtn2.png}" style="width: 100%;">
			</button>
			<button th:if="${mid == 'none'}" type="button" style="background-color:transparent; border:none; width: 300px; float: right; margin-top: 10%;" onclick="location.href='/elogin'">
					<img th:src="@{./e-comm/images/pointbtn1.png}" style="width: 100%;">
			</button>
			
			
	        </div>
	        <div align="center">
				
			</div>
	
	        <br />
	
			<table align="center" style="text-align: center; background-color: white; border:thick; width: 100%; ">
	            <thead>
	                <tr style="background-color: #F6EEC9;">
	                    <th>일</th>
	                    <th>월</th>
	                    <th>화</th>
	                    <th>수</th>
	                    <th>목</th>
	                    <th>금</th>
	                    <th>토</th>
	                </tr>
	            </thead>
	            <tbody>
					<tr th:each="weekIndex : ${weeks}">
						<td th:each="dayIndex : ${dayIndexes}">
							<p th:if="${(weekIndex * 7 + dayIndex) >= (firstDayOfWeek ) && (weekIndex * 7 + dayIndex) < (firstDayOfWeek  + days.size()) && ((weekIndex * 7 + dayIndex) - (firstDayOfWeek ) + 1) != 0}"
							th:text="${(weekIndex * 7 + dayIndex) - (firstDayOfWeek ) + 1}"></p>
               
							<div th:each="p : ${point}" th:if="${((weekIndex * 7 + dayIndex) - (firstDayOfWeek ) + 1) == p}">
								<img th:src="@{./e-comm/images/stemp.png}" style="width: 40%;">
							</div>
        	
						</td>
					</tr>
	            </tbody>
			</table>
			<br><br>
		</div>
	    
		<img th:src="@{./e-comm/images/rouletteimg.jpg}" style="width: 100%;">
		
		<div id="wrap" style="background-color: #F6EEC9;">
			<div id="gameContainer">
				<div class="board_on obj"></div>
			</div>
			
			<div id="popup_gift" class="popup">
				<div class="lottery_present"></div>
				<a href="javascript:;" class="close" id="closebut">닫기 </a>
			</div>
			
			<div align="center">
				<button th:if="${mid != 'none' && rouletteY != 1}" type="button" class="join" style="background-color:transparent; border:none; width: 300px;">
	            	<img th:src="@{./e-comm/images/roulettebut.png}" style="width: 100%;">
	            </button>
	            <button th:if="${mid != 'none' && rouletteY == 1}" type="button" style="background-color:transparent; border:none; width: 300px;">
	            	<img th:src="@{./e-comm/images/roulettebut2.png}" style="width: 100%;">
	            </button>
	            <button th:if="${mid == 'none'}" type="button" style="background-color:transparent; border:none; width: 300px;" onclick="location.href='/elogin'">
	            	<img th:src="@{./e-comm/images/roulettebut1.png}" style="width: 100%;">
	            </button>
			</div>    
			<br><br><br>
		</div>
		<img th:src="@{./e-comm/images/pointer.png}" style="width: 50px; position: absolute; left:49%; top:245%;">
        
    </div>
</section>


<div class="static">

	<button class="butellipse" style="background-color:#A1DD70" onclick="focusbut('point')">출석이동</button><br>
	<button class="butellipse" style="background-color:#F6EEC9;" onclick="focusbut('gameContainer')">룰렛이동</button>
</div>


<th:block th:insert="~{ecom_fragments::footer}"></th:block>
    <!-- 
    Essential Scripts
    =====================================-->
    
    <!-- Main jQuery -->
    <script src="./e-comm/plugins/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap 3.1 -->
    <script src="./e-comm/plugins/bootstrap/js/bootstrap.min.js"></script>
    <!-- Bootstrap Touchpin -->
    <script src="./e-comm/plugins/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>
    <!-- Instagram Feed Js -->
    <script src="./e-comm/plugins/instafeed/instafeed.min.js"></script>
    <!-- Video Lightbox Plugin -->
    <script src="./e-comm/plugins/ekko-lightbox/dist/ekko-lightbox.min.js"></script>
    <!-- Count Down Js -->
    <script src="./e-comm/plugins/syo-timer/build/jquery.syotimer.min.js"></script>

    <!-- slick Carousel -->
    <script src="./e-comm/plugins/slick/slick.min.js"></script>
    <script src="./e-comm/plugins/slick/slick-animation.min.js"></script>

    <!-- Google Mapl -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCC72vZw-6tGqFyRhhg5CkF2fqfILn2Tsw"></script>
    <script type="text/javascript" src="./e-comm/plugins/google-map/gmap.js"></script>

    <!-- Main Js File -->
    <script src="js/script.js"></script>
    
    <!-- 애니메이션 효과 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.1/gsap.min.js" integrity="sha512-qF6akR/fsZAB4Co1QDDnUXWnaQseLGXoniuSuSlPQK6+aWhlMZcHzkasCSlnWoe+TJuudlka1/IQ01Dnhgq95g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
<script th:inline="javascript">

	$(document).ready(function() {
		
		var gift;
		var  present =[ 1,2,3,4,5,6 ]
	
		iniGame = function(num){
			
			gift = num;
			TweenLite.killTweensOf($(".board_on"));
			TweenLite.to($(".board_on"), 0, {css:{rotation:rotationPos[gift]}});
			TweenLite.from($(".board_on"),5, {css:{rotation:-3000}, onComplete:endGame, ease:Sine.easeOut});
	        console.log("gift 숫자 : "+ (gift +1) +"rotationPos" + rotationPos);
		}
	
		var rotationPos = new Array(60,120,180,240,300,360);
		
		TweenLite.to($(".board_on"), 360, {css:{rotation:-4000}, ease: Linear.easeNone});
		
		function endGame(){
			
			var  copImg= "./e-comm/images/coupon"+(gift +1) + ".png";
			console.log("이미지 : " + copImg );
			
			var point = '10';
			
			if((gift+1) == 1){
				point = '1000';
			}
			
			if((gift+1) == 2 || (gift+1) == 4){
				point = '100';
			}
			
			
			$("#popup_gift .lottery_present" ).text(function( ) { 
				return "축하드립니다."+ (point)   + "P를 획득 하셨습니다.";});
			
			$( '<img  src="' + copImg+ '" style="width: 40%;" />' ).prependTo("#popup_gift .lottery_present");
			
			setTimeout(function() {
				pointF(0, point);
				openPopup("popup_gift");	}, 1000);
		}

		
		$(".popup .btn").on("click",function(){
			location.reload();
		});
		
		function openPopup(id) {
			closePopup();
			$('.popup').slideUp(0);
			var popupid = id
			$('body').append('<div id="fade"></div>');
			$('#fade').css({
			'filter' : 'alpha(opacity=60)'
			}).fadeIn(300);
			var popuptopmargin = ($('#' + popupid).height()) / 2;
			var popupleftmargin = ($('#' + popupid).width()) / 2;
			$('#' + popupid).css({
				'margin-left' : -popupleftmargin
			});
			$('#' + popupid).slideDown(500);
		}
		function closePopup() {
			$('#fade').fadeOut(300, function() {
				// $(".player").html('');
			});
			$('.popup').slideUp(400);
			return false
		}
		$(".close").click(closePopup);
	
	});



$(function() {
	var clicked  =0;
	for(i=1; i<7; i++){
	  var  pictures = "./e-comm/images/coupon"+ i  + ".png";
	  $(".board_on").append('<img  src="' + pictures + '" />');
	}

	$(".join").on("mousedown",function(){
	  if( clicked <= 0){    iniGame(Math.floor(Math.random() *6));    }
	  else  if( clicked >=1 ){    event.preventDefault(); alert( "이벤트 참여 하셨습니다."); }
	  clicked ++
	});
})


	//포커스 버튼
	function focusbut(getid) {
		$("#"+getid).attr("tabindex", -1).focus();
	}
	
	$("#closebut").click(function() {
		window.location.reload();
	});


	//포인트 적립 룰렛
	function pointF(gno, gpoint) {
	
		var gid = [[${mid}]];

	    $.ajax({
	        type: 'POST',
	        url: '/epoint',
	        data: {gid:gid, gno:gno, gpoint:gpoint},
	        
	        //컨트롤러 성공 시 
	        success: function(response) {
	        	
	        	if(response !== 'Y') {
	        		alert("오류가 발생했습니다.");
	        	}
	        	
	        },
	
	        // 컨트롤러 실패 시
	        error: function() {
	            alert('오류가 발생했습니다. 아이디 찾기를 재시도 하시거나, 문의 게시판에 글을 남겨주세요.');
	            
	        }
	    });
	    
	    if(gno == 1) {
	    	window.location.reload(); // 페이지 재로드
	    }
	}

</script>

  </body>
  </html>
